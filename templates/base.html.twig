<!DOCTYPE html>
<html lang="fr" data-bs-theme="light">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="/images/favicon.png">
        {% block stylesheets %}
        <script>
            (function(){try{
            var m = localStorage.getItem('theme') || 'auto';
            var fin = (m==='auto') ? (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light') : m;
            document.documentElement.setAttribute('data-bs-theme', fin);
            document.documentElement.style.colorScheme = fin==='dark'?'dark':'light';
            }catch(e){}})();
        </script>


        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" 
            integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

        <link rel="stylesheet" href="{{ asset('styles/app.css') }}">
        {% endblock %}

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>
    <body id="top">

        {% include 'partial/navbar.html.twig' %}
        {% include 'partial/flash.html.twig' %}

        {% block body %}
        
        {% endblock %}

        {% include 'partial/footer.html.twig' %}
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"></script>
        <a href="#top" class="back-to-top" aria-label="Retour en haut">
            <i class="bi bi-arrow-up"></i>
        </a>
        <script>
            (() => {
            // √âvite double init si Turbo recolle l'HTML
            if (window.__themeInitDone__) return; 
            window.__themeInitDone__ = true;

            const KEY = 'theme';                           // 'light' | 'dark' | 'auto'
            const mq  = matchMedia('(prefers-color-scheme: dark)');

            const getStored = () => localStorage.getItem(KEY) || 'auto';
            const finalOf   = m => (m==='auto' ? (mq.matches ? 'dark':'light') : m);

            function apply(mode) {
                const fin = finalOf(mode);
                const html = document.documentElement;
                html.setAttribute('data-bs-theme', fin);
                html.style.colorScheme = fin==='dark'?'dark':'light';
                // sync UI si pr√©sents
                const desk = document.getElementById('theme-toggle-switch');
                if (desk) desk.checked = (fin==='dark');
                document.querySelectorAll('.theme-choice').forEach(b => {
                const on = b.dataset.mode === mode;
                b.classList.toggle('active', on);
                b.setAttribute('aria-pressed', on ? 'true' : 'false');
                });
                // event pour autres scripts √©ventuellement
                window.dispatchEvent(new CustomEvent('theme:changed', { detail:{mode, final:fin} }));
            }

            function setMode(mode) {
                localStorage.setItem(KEY, mode);
                apply(mode);
            }

            // ‚Äî‚Äî‚Äî‚Äî‚Äî binding idempotent (on peut rappeler sans empiler) ‚Äî‚Äî‚Äî‚Äî‚Äî
            function bind() {
                // unbind d‚Äôabord
                document.querySelectorAll('[data-theme-bound]').forEach(el => {
                el.replaceWith(el.cloneNode(true)); // supprime les √©couteurs
                });

                // re-s√©lectionner apr√®s clone
                const desk = document.getElementById('theme-toggle-switch');
                if (desk) {
                desk.setAttribute('data-theme-bound', '1');
                desk.addEventListener('change', () => setMode(desk.checked ? 'dark' : 'light'), { passive:true });
                }

                document.querySelectorAll('.theme-choice').forEach(btn => {
                btn.setAttribute('data-theme-bound', '1');
                btn.addEventListener('click', () => setMode(btn.dataset.mode), { passive:true });
                });

                // appliquer l‚Äô√©tat courant
                apply(getStored());
            }

            // Init au chargement initial
            const init = () => bind();

            // DOMContentLoaded (premier chargement)
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init, { once:true });
            } else { init(); }

            // OS change pour AUTO
            mq.addEventListener('change', () => { if (getStored()==='auto') apply('auto'); });

            // Multi-onglets
            window.addEventListener('storage', (e) => { if (e.key===KEY) apply(getStored()); });

            // üî• Turbo : rebinder √† chaque navigation
            window.addEventListener('turbo:load', bind);
            window.addEventListener('turbo:render', bind);
            })();
        </script>

        <script>
            (() => {
                const opts = { root: null, rootMargin: "0px 0px -10% 0px", threshold: 0.12 };
                const io = new IntersectionObserver((entries) => {
                    entries.forEach(e => {
                        if (e.isIntersecting) {
                            e.target.classList.add('is-in');
                            io.unobserve(e.target); // joue une fois (retire cette ligne si tu veux rejouer)
                        }
                    });
                }, opts);

                document.querySelectorAll('.reveal, .reveal-stagger').forEach(el => io.observe(el));
            })();
        </script>

        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080">
            <div id="contactToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                <div class="toast-body" id="contactToastMessage">
                    Message envoy√© ‚úîÔ∏è
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>

            <div id="contactToastError" class="toast align-items-center text-bg-danger border-0 mt-2" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                <div class="toast-body" id="contactToastErrorMessage">
                    Oups, un probl√®me est survenu.
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
            </div>

    </body>

</html>
